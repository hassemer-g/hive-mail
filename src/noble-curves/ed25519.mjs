/* esm.sh - @noble/curves@2.0.1/ed25519 */
import{sha512 as y}from"../noble-hashes/sha2.mjs";import{abytes as Z,concatBytes as tt,hexToBytes as ft}from"../noble-hashes/utils.mjs";import{eddsa as nt,edwards as ot,PrimeEdwardsPoint as et}from"./abstract/edwards.mjs";import{_DST_scalar as st,createHasher as ct,expand_message_xmd as X}from"./abstract/hash-to-curve.mjs";import{FpInvertBatch as rt,FpSqrtEven as it,isNegativeLE as w,mod as S,pow2 as E}from"./abstract/modular.mjs";import{montgomery as at}from"./abstract/montgomery.mjs";import{createORPF as dt}from"./abstract/oprf.mjs";import{asciiToBytes as lt,bytesToNumberLE as W,equalBytes as _t}from"./utils.mjs";var ut=BigInt(0),h=BigInt(1),O=BigInt(2),Y=BigInt(3),G=BigInt(5),A=BigInt(8),v=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),C={p:v,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:A,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function j(o){let e=BigInt(10),s=BigInt(20),c=BigInt(40),d=BigInt(80),n=v,i=o*o%n*o%n,r=E(i,O,n)*i%n,a=E(r,h,n)*o%n,l=E(a,G,n)*a%n,u=E(l,e,n)*l%n,m=E(u,s,n)*u%n,p=E(m,c,n)*m%n,x=E(p,d,n)*p%n,_=E(x,d,n)*p%n,g=E(_,e,n)*l%n;return{pow_p_5_8:E(g,O,n)*o%n,b2:i}}function k(o){return o[0]&=248,o[31]&=127,o[31]|=64,o}var q=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function U(o,e){let s=v,c=S(e*e*e,s),d=S(c*c*e,s),n=j(o*d).pow_p_5_8,f=S(o*c*n,s),i=S(e*f*f,s),r=f,a=S(f*q,s),l=i===o,u=i===S(-o,s),m=i===S(-o*q,s);return l&&(f=r),(u||m)&&(f=a),w(f,s)&&(f=S(-f,s)),{isValid:l||u,value:f}}var I=ot(C,{uvRatio:U}),t=I.Fp,z=I.Fn;function J(o,e,s){if(e.length>255)throw new Error("Context is too big");return tt(lt("SigEd25519 no Ed25519 collisions"),new Uint8Array([s?1:0,e.length]),e,o)}function F(o){return nt(I,y,Object.assign({adjustScalarBytes:k},o))}var qt=F({}),Mt=F({domain:J}),Lt=F({domain:J,prehash:y}),Pt=(()=>{let o=v;return at({P:o,type:"x25519",powPminus2:e=>{let{pow_p_5_8:s,b2:c}=j(e);return S(E(s,Y,o)*c,o)},adjustScalarBytes:k})})(),mt=(v+Y)/A,pt=t.pow(O,mt),H=t.sqrt(t.neg(t.ONE));function xt(o){let e=(v-G)/A,s=BigInt(486662),c=t.sqr(o);c=t.mul(c,O);let d=t.add(c,t.ONE),n=t.neg(s),f=t.sqr(d),i=t.mul(f,d),r=t.mul(c,s);r=t.mul(r,n),r=t.add(r,f),r=t.mul(r,n);let a=t.sqr(i);f=t.sqr(a),a=t.mul(a,i),a=t.mul(a,r),f=t.mul(f,a);let l=t.pow(f,e);l=t.mul(l,a);let u=t.mul(l,H);f=t.sqr(l),f=t.mul(f,i);let m=t.eql(f,r),p=t.cmov(u,l,m),x=t.mul(n,c),_=t.mul(l,o);_=t.mul(_,pt);let g=t.mul(_,H),B=t.mul(r,c);f=t.sqr(_),f=t.mul(f,i);let D=t.eql(f,B),N=t.cmov(g,_,D);f=t.sqr(p),f=t.mul(f,i);let R=t.eql(f,r),K=t.cmov(x,n,R),T=t.cmov(N,p,R),$=t.isOdd(T);return T=t.cmov(T,t.neg(T),R!==$),{xMn:K,xMd:d,yMn:T,yMd:h}}var gt=it(t,t.neg(BigInt(486664)));function Bt(o){let{xMn:e,xMd:s,yMn:c,yMd:d}=xt(o),n=t.mul(e,d);n=t.mul(n,gt);let f=t.mul(s,c),i=t.sub(e,s),r=t.add(e,s),a=t.mul(f,r),l=t.eql(a,t.ZERO);n=t.cmov(n,t.ZERO,l),f=t.cmov(f,t.ONE,l),i=t.cmov(i,t.ONE,l),r=t.cmov(r,t.ONE,l);let[u,m]=rt(t,[f,r],!0);return{x:t.mul(n,u),y:t.mul(i,m)}}var At=ct(I,o=>Bt(o[0]),{DST:"edwards25519_XMD:SHA-512_ELL2_RO_",encodeDST:"edwards25519_XMD:SHA-512_ELL2_NU_",p:v,m:1,k:128,expand:"xmd",hash:y}),M=q,Et=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),ht=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),vt=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),St=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),Q=o=>U(h,o),It=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),L=o=>t.create(W(o)&It);function V(o){let{d:e}=C,s=v,c=B=>t.create(B),d=c(M*o*o),n=c((d+h)*vt),f=BigInt(-1),i=c((f-e*d)*c(d+e)),{isValid:r,value:a}=U(n,i),l=c(a*o);w(l,s)||(l=c(-l)),r||(a=l),r||(f=d);let u=c(f*(d-h)*St-i),m=a*a,p=c((a+a)*i),x=c(u*Et),_=c(h-m),g=c(h+m);return new I(c(p*g),c(_*x),c(x*g),c(p*_))}var b=class o extends et{static BASE=new o(I.BASE);static ZERO=new o(I.ZERO);static Fp=t;static Fn=z;constructor(e){super(e)}static fromAffine(e){return new o(I.fromAffine(e))}assertSame(e){if(!(e instanceof o))throw new Error("RistrettoPoint expected")}init(e){return new o(e)}static fromBytes(e){Z(e,32);let{a:s,d:c}=C,d=v,n=R=>t.create(R),f=L(e);if(!_t(t.toBytes(f),e)||w(f,d))throw new Error("invalid ristretto255 encoding 1");let i=n(f*f),r=n(h+s*i),a=n(h-s*i),l=n(r*r),u=n(a*a),m=n(s*c*l-u),{isValid:p,value:x}=Q(n(m*u)),_=n(x*a),g=n(x*_*m),B=n((f+f)*_);w(B,d)&&(B=n(-B));let D=n(r*g),N=n(B*D);if(!p||w(N,d)||D===ut)throw new Error("invalid ristretto255 encoding 2");return new o(new I(B,D,h,N))}static fromHex(e){return o.fromBytes(ft(e))}toBytes(){let{X:e,Y:s,Z:c,T:d}=this.ep,n=v,f=g=>t.create(g),i=f(f(c+s)*f(c-s)),r=f(e*s),a=f(r*r),{value:l}=Q(f(i*a)),u=f(l*i),m=f(l*r),p=f(u*m*d),x;if(w(d*p,n)){let g=f(s*M),B=f(e*M);e=g,s=B,x=f(u*ht)}else x=m;w(e*p,n)&&(s=f(-s));let _=f((c-s)*x);return w(_,n)&&(_=f(-_)),t.toBytes(_)}equals(e){this.assertSame(e);let{X:s,Y:c}=this.ep,{X:d,Y:n}=e.ep,f=a=>t.create(a),i=f(s*n)===f(c*d),r=f(c*n)===f(s*d);return i||r}is0(){return this.equals(o.ZERO)}},Ct={Point:b},P={Point:b,hashToCurve(o,e){let s=e?.DST||"ristretto255_XMD:SHA-512_R255MAP_RO_",c=X(o,s,64,y);return P.deriveToCurve(c)},hashToScalar(o,e={DST:st}){let s=X(o,e.DST,64,y);return z.create(W(s))},deriveToCurve(o){Z(o,64);let e=L(o.subarray(0,32)),s=V(e),c=L(o.subarray(32,64)),d=V(c);return new b(s.add(d))}},Ut=dt({name:"ristretto255-SHA512",Point:b,hash:y,hashToGroup:P.hashToCurve,hashToScalar:P.hashToScalar}),Ft=["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"];export{Ft as ED25519_TORSION_SUBGROUP,xt as _map_to_curve_elligator2_curve25519,qt as ed25519,At as ed25519_hasher,Mt as ed25519ctx,Lt as ed25519ph,Ct as ristretto255,P as ristretto255_hasher,Ut as ristretto255_oprf,Pt as x25519};
/*! Bundled license information:

@noble/curves/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=ed25519.mjs.map
