/* esm.sh - @noble/ciphers@2.0.1/_polyval */
import{abytes as k,aexists as S,aoutput as A,clean as I,copyBytes as U,createView as V,u32 as a}from"./utils.mjs";var f=16,O=new Uint8Array(16),l=a(O),j=225,C=(o,t,s,e)=>{let i=e&1;return{s3:s<<31|e>>>1,s2:t<<31|s>>>1,s1:o<<31|t>>>1,s0:o>>>1^j<<24&-(i&1)}},c=o=>(o>>>0&255)<<24|(o>>>8&255)<<16|(o>>>16&255)<<8|o>>>24&255|0;function Y(o){o.reverse();let t=o[15]&1,s=0;for(let e=0;e<o.length;e++){let i=o[e];o[e]=i>>>1|s,s=(i&1)<<7}return o[0]^=-t&225,o}var q=o=>o>64*1024?8:o>1024?4:2,_=class{blockLen=f;outputLen=f;s0=0;s1=0;s2=0;s3=0;finished=!1;t;W;windowSize;constructor(t,s){k(t,16,"key"),t=U(t);let e=V(t),i=e.getUint32(0,!1),n=e.getUint32(4,!1),r=e.getUint32(8,!1),b=e.getUint32(12,!1),g=[];for(let u=0;u<128;u++)g.push({s0:c(i),s1:c(n),s2:c(r),s3:c(b)}),{s0:i,s1:n,s2:r,s3:b}=C(i,n,r,b);let h=q(s||1024);if(![1,2,4,8].includes(h))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=h;let y=128/h,z=this.windowSize=2**h,x=[];for(let u=0;u<y;u++)for(let p=0;p<z;p++){let B=0,w=0,L=0,m=0;for(let d=0;d<h;d++){if(!(p>>>h-d-1&1))continue;let{s0:E,s1:M,s2:P,s3:R}=g[h*u+d];B^=E,w^=M,L^=P,m^=R}x.push({s0:B,s1:w,s2:L,s3:m})}this.t=x}_updateBlock(t,s,e,i){t^=this.s0,s^=this.s1,e^=this.s2,i^=this.s3;let{W:n,t:r,windowSize:b}=this,g=0,h=0,W=0,y=0,z=(1<<n)-1,x=0;for(let u of[t,s,e,i])for(let p=0;p<4;p++){let B=u>>>8*p&255;for(let w=8/n-1;w>=0;w--){let L=B>>>n*w&z,{s0:m,s1:d,s2:v,s3:E}=r[x*b+L];g^=m,h^=d,W^=v,y^=E,x+=1}}this.s0=g,this.s1=h,this.s2=W,this.s3=y}update(t){S(this),k(t),t=U(t);let s=a(t),e=Math.floor(t.length/f),i=t.length%f;for(let n=0;n<e;n++)this._updateBlock(s[n*4+0],s[n*4+1],s[n*4+2],s[n*4+3]);return i&&(O.set(t.subarray(e*f)),this._updateBlock(l[0],l[1],l[2],l[3]),I(l)),this}destroy(){let{t}=this;for(let s of t)s.s0=0,s.s1=0,s.s2=0,s.s3=0}digestInto(t){S(this),A(t,this),this.finished=!0;let{s0:s,s1:e,s2:i,s3:n}=this,r=a(t);return r[0]=s,r[1]=e,r[2]=i,r[3]=n,t}digest(){let t=new Uint8Array(f);return this.digestInto(t),this.destroy(),t}},K=class extends _{constructor(t,s){k(t);let e=Y(U(t));super(e,s),I(e)}update(t){S(this),k(t),t=U(t);let s=a(t),e=t.length%f,i=Math.floor(t.length/f);for(let n=0;n<i;n++)this._updateBlock(c(s[n*4+3]),c(s[n*4+2]),c(s[n*4+1]),c(s[n*4+0]));return e&&(O.set(t.subarray(i*f)),this._updateBlock(c(l[3]),c(l[2]),c(l[1]),c(l[0])),I(l)),this}digestInto(t){S(this),A(t,this),this.finished=!0;let{s0:s,s1:e,s2:i,s3:n}=this,r=a(t);return r[0]=s,r[1]=e,r[2]=i,r[3]=n,t.reverse()}};function Z(o){let t=(e,i)=>o(i,e.length).update(e).digest(),s=o(new Uint8Array(16),0);return t.outputLen=s.outputLen,t.blockLen=s.blockLen,t.create=(e,i)=>o(e,i),t}var F=Z((o,t)=>new _(o,t)),G=Z((o,t)=>new K(o,t));export{_ as GHASH,K as Polyval,Y as _toGHASHKey,F as ghash,G as polyval};
//# sourceMappingURL=_polyval.mjs.map
