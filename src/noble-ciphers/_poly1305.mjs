/* esm.sh - @noble/ciphers@2.0.1/_poly1305 */
import{abytes as X,aexists as Y,aoutput as D,bytesToHex as tf,clean as Z,concatBytes as sf,copyBytes as $,hexToNumber as nf,numberToBytesBE as ef}from"./utils.mjs";function c(v,f){return v[f++]&255|(v[f++]&255)<<8}var j=class{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(f){f=$(X(f,32,"key"));let i=c(f,0),e=c(f,2),o=c(f,4),s=c(f,6),r=c(f,8),t=c(f,10),h=c(f,12),l=c(f,14);this.r[0]=i&8191,this.r[1]=(i>>>13|e<<3)&8191,this.r[2]=(e>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|r<<12)&255,this.r[5]=r>>>1&8190,this.r[6]=(r>>>14|t<<2)&8191,this.r[7]=(t>>>11|h<<5)&8065,this.r[8]=(h>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let x=0;x<8;x++)this.pad[x]=c(f,16+2*x)}process(f,i,e=!1){let o=e?0:2048,{h:s,r}=this,t=r[0],h=r[1],l=r[2],x=r[3],u=r[4],p=r[5],b=r[6],a=r[7],g=r[8],d=r[9],q=c(f,i+0),F=c(f,i+2),G=c(f,i+4),J=c(f,i+6),R=c(f,i+8),Q=c(f,i+10),S=c(f,i+12),V=c(f,i+14),y=s[0]+(q&8191),B=s[1]+((q>>>13|F<<3)&8191),I=s[2]+((F>>>10|G<<6)&8191),m=s[3]+((G>>>7|J<<9)&8191),L=s[4]+((J>>>4|R<<12)&8191),_=s[5]+(R>>>1&8191),w=s[6]+((R>>>14|Q<<2)&8191),U=s[7]+((Q>>>11|S<<5)&8191),A=s[8]+((S>>>8|V<<8)&8191),T=s[9]+(V>>>5|o),n=0,P=n+y*t+B*(5*d)+I*(5*g)+m*(5*a)+L*(5*b);n=P>>>13,P&=8191,P+=_*(5*p)+w*(5*u)+U*(5*x)+A*(5*l)+T*(5*h),n+=P>>>13,P&=8191;let W=n+y*h+B*t+I*(5*d)+m*(5*g)+L*(5*a);n=W>>>13,W&=8191,W+=_*(5*b)+w*(5*p)+U*(5*u)+A*(5*x)+T*(5*l),n+=W>>>13,W&=8191;let z=n+y*l+B*h+I*t+m*(5*d)+L*(5*g);n=z>>>13,z&=8191,z+=_*(5*a)+w*(5*b)+U*(5*p)+A*(5*u)+T*(5*x),n+=z>>>13,z&=8191;let E=n+y*x+B*l+I*h+m*t+L*(5*d);n=E>>>13,E&=8191,E+=_*(5*g)+w*(5*a)+U*(5*b)+A*(5*p)+T*(5*u),n+=E>>>13,E&=8191;let M=n+y*u+B*x+I*l+m*h+L*t;n=M>>>13,M&=8191,M+=_*(5*d)+w*(5*g)+U*(5*a)+A*(5*b)+T*(5*p),n+=M>>>13,M&=8191;let N=n+y*p+B*u+I*x+m*l+L*h;n=N>>>13,N&=8191,N+=_*t+w*(5*d)+U*(5*g)+A*(5*a)+T*(5*b),n+=N>>>13,N&=8191;let O=n+y*b+B*p+I*u+m*x+L*l;n=O>>>13,O&=8191,O+=_*h+w*t+U*(5*d)+A*(5*g)+T*(5*a),n+=O>>>13,O&=8191;let C=n+y*a+B*b+I*p+m*u+L*x;n=C>>>13,C&=8191,C+=_*l+w*h+U*t+A*(5*d)+T*(5*g),n+=C>>>13,C&=8191;let H=n+y*g+B*a+I*b+m*p+L*u;n=H>>>13,H&=8191,H+=_*x+w*l+U*h+A*t+T*(5*d),n+=H>>>13,H&=8191;let K=n+y*d+B*g+I*a+m*b+L*p;n=K>>>13,K&=8191,K+=_*u+w*x+U*l+A*h+T*t,n+=K>>>13,K&=8191,n=(n<<2)+n|0,n=n+P|0,P=n&8191,n=n>>>13,W+=n,s[0]=P,s[1]=W,s[2]=z,s[3]=E,s[4]=M,s[5]=N,s[6]=O,s[7]=C,s[8]=H,s[9]=K}finalize(){let{h:f,pad:i}=this,e=new Uint16Array(10),o=f[1]>>>13;f[1]&=8191;for(let t=2;t<10;t++)f[t]+=o,o=f[t]>>>13,f[t]&=8191;f[0]+=o*5,o=f[0]>>>13,f[0]&=8191,f[1]+=o,o=f[1]>>>13,f[1]&=8191,f[2]+=o,e[0]=f[0]+5,o=e[0]>>>13,e[0]&=8191;for(let t=1;t<10;t++)e[t]=f[t]+o,o=e[t]>>>13,e[t]&=8191;e[9]-=8192;let s=(o^1)-1;for(let t=0;t<10;t++)e[t]&=s;s=~s;for(let t=0;t<10;t++)f[t]=f[t]&s|e[t];f[0]=(f[0]|f[1]<<13)&65535,f[1]=(f[1]>>>3|f[2]<<10)&65535,f[2]=(f[2]>>>6|f[3]<<7)&65535,f[3]=(f[3]>>>9|f[4]<<4)&65535,f[4]=(f[4]>>>12|f[5]<<1|f[6]<<14)&65535,f[5]=(f[6]>>>2|f[7]<<11)&65535,f[6]=(f[7]>>>5|f[8]<<8)&65535,f[7]=(f[8]>>>8|f[9]<<5)&65535;let r=f[0]+i[0];f[0]=r&65535;for(let t=1;t<8;t++)r=(f[t]+i[t]|0)+(r>>>16)|0,f[t]=r&65535;Z(e)}update(f){Y(this),X(f),f=$(f);let{buffer:i,blockLen:e}=this,o=f.length;for(let s=0;s<o;){let r=Math.min(e-this.pos,o-s);if(r===e){for(;e<=o-s;s+=e)this.process(f,s);continue}i.set(f.subarray(s,s+r),this.pos),this.pos+=r,s+=r,this.pos===e&&(this.process(i,0,!1),this.pos=0)}return this}destroy(){Z(this.h,this.r,this.buffer,this.pad)}digestInto(f){Y(this),D(f,this),this.finished=!0;let{buffer:i,h:e}=this,{pos:o}=this;if(o){for(i[o++]=1;o<16;o++)i[o]=0;this.process(i,0,!0)}this.finalize();let s=0;for(let r=0;r<8;r++)f[s++]=e[r]>>>0,f[s++]=e[r]>>>8;return f}digest(){let{buffer:f,outputLen:i}=this;this.digestInto(f);let e=f.slice(0,i);return this.destroy(),e}};function k(v){let f=(e,o)=>v(o).update(e).digest(),i=v(new Uint8Array(32));return f.outputLen=i.outputLen,f.blockLen=i.blockLen,f.create=e=>v(e),f}var rf=k(v=>new j(v));export{j as Poly1305,rf as poly1305,k as wrapConstructorWithKey};
//# sourceMappingURL=_poly1305.mjs.map
